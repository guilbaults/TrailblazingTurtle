
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../development/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>Data collection - TrailblazingTurtle</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#data-sources" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="TrailblazingTurtle" class="md-header__button md-logo" aria-label="TrailblazingTurtle" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            TrailblazingTurtle
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Data collection
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/guilbaults/TrailblazingTurtle/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="TrailblazingTurtle" class="md-nav__button md-logo" aria-label="TrailblazingTurtle" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    TrailblazingTurtle
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/guilbaults/TrailblazingTurtle/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Data collection
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Data collection
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#slurm-job-exporter" class="md-nav__link">
    <span class="md-ellipsis">
      slurm-job-exporter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#access-to-the-database-of-slurmacct" class="md-nav__link">
    <span class="md-ellipsis">
      Access to the database of slurmacct
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#slurm-exporter" class="md-nav__link">
    <span class="md-ellipsis">
      slurm-exporter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lustre_exporter-and-lustre_exporter_slurm" class="md-nav__link">
    <span class="md-ellipsis">
      lustre_exporter and lustre_exporter_slurm
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gpfs_exporter" class="md-nav__link">
    <span class="md-ellipsis">
      gpfs_exporter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#redfish_exporter" class="md-nav__link">
    <span class="md-ellipsis">
      redfish_exporter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#node_exporter" class="md-nav__link">
    <span class="md-ellipsis">
      node_exporter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#libvirtd_exporter" class="md-nav__link">
    <span class="md-ellipsis">
      libvirtd_exporter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcm-sensor-server" class="md-nav__link">
    <span class="md-ellipsis">
      pcm-sensor-server
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#database-used-by-robinhood" class="md-nav__link">
    <span class="md-ellipsis">
      Database used by Robinhood
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#slurm-jobscript" class="md-nav__link">
    <span class="md-ellipsis">
      Slurm jobscript
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../development/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Development
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../install/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Modules
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Modules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../jobstats/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Job Stats
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../top/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Top
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../usersummary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    User Summary
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../accountstats/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Account Stats
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloudstats/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cloud Stats
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nodes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Nodes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quotas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quotas
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quotasgpfs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quotas GPFS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cfaccess/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CF Access
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#slurm-job-exporter" class="md-nav__link">
    <span class="md-ellipsis">
      slurm-job-exporter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#access-to-the-database-of-slurmacct" class="md-nav__link">
    <span class="md-ellipsis">
      Access to the database of slurmacct
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#slurm-exporter" class="md-nav__link">
    <span class="md-ellipsis">
      slurm-exporter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lustre_exporter-and-lustre_exporter_slurm" class="md-nav__link">
    <span class="md-ellipsis">
      lustre_exporter and lustre_exporter_slurm
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gpfs_exporter" class="md-nav__link">
    <span class="md-ellipsis">
      gpfs_exporter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#redfish_exporter" class="md-nav__link">
    <span class="md-ellipsis">
      redfish_exporter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#node_exporter" class="md-nav__link">
    <span class="md-ellipsis">
      node_exporter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#libvirtd_exporter" class="md-nav__link">
    <span class="md-ellipsis">
      libvirtd_exporter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcm-sensor-server" class="md-nav__link">
    <span class="md-ellipsis">
      pcm-sensor-server
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#database-used-by-robinhood" class="md-nav__link">
    <span class="md-ellipsis">
      Database used by Robinhood
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#slurm-jobscript" class="md-nav__link">
    <span class="md-ellipsis">
      Slurm jobscript
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="data-sources">Data sources</h1>
<p>The main requirement to monitor a Slurm cluster is to install slurm-job-exporter and open a read-only access to the Slurm MySQL database. Other data sources in this page can be installed to gather more data.</p>
<h2 id="slurm-job-exporter">slurm-job-exporter</h2>
<p><a href="https://github.com/guilbaults/slurm-job-exporter">slurm-job-exporter</a> is used to capture information from cgroups managed by Slurm on each compute node. This gathers CPU, memory, and GPU utilization.</p>
<p>The following recorder rules are used to pre-aggregate stats shown in the user portal.</p>
<div class="highlight"><pre><span></span><code>---
groups:
- name: recorder.rules
  rules:
  - record: slurm_job:allocated_core:count
    expr: count(slurm_job_core_usage_total) by (cluster)
  - record: slurm_job:allocated_core:count_user_account
    expr: count(slurm_job_core_usage_total) by (user,account,cluster)
  - record: slurm_job:used_core:sum
    expr: sum(rate(slurm_job_core_usage_total{}[2m]) / 1000000000) by (cluster)
  - record: slurm_job:used_core:sum_user_account
    expr: sum(rate(slurm_job_core_usage_total{}[2m]) / 1000000000) by (user,account, cluster)
  - record: slurm_job:allocated_memory:sum
    expr: sum(slurm_job_memory_limit{}) by (cluster)
  - record: slurm_job:allocated_memory:sum_user_account
    expr: sum(slurm_job_memory_limit{}) by (user,account,cluster)
  - record: slurm_job:rss_memory:sum
    expr: sum(slurm_job_memory_rss) by (cluster)
  - record: slurm_job:rss_memory:sum_user_account
    expr: sum(slurm_job_memory_rss) by (user, account, cluster)
  - record: slurm_job:max_memory:sum_user_account
    expr: sum(slurm_job_memory_max) by (user, account, cluster)
  - record: slurm_job:allocated_gpu:count
    expr: count(slurm_job_utilization_gpu) by (cluster)
  - record: slurm_job:allocated_gpu:count_user_account
    expr: count(slurm_job_utilization_gpu) by (user, account, cluster)
  - record: slurm_job:used_gpu:sum
    expr: sum(slurm_job_utilization_gpu) by (cluster)/ 100
  - record: slurm_job:used_gpu:sum_user_account
    expr: sum(slurm_job_utilization_gpu) by (gpu_type,user,account,cluster) / 100
  - record: slurm_job:non_idle_gpu:sum_user_account
    expr: count(slurm_job_utilization_gpu &gt; 0) by (gpu_type,user,account,cluster)
  - record: slurm_job:power_gpu:sum
    expr: sum(slurm_job_power_gpu) by (gpu_type,cluster)
  - record: slurm_job:power_gpu:sum_user_account
    expr: sum(slurm_job_power_gpu) by (gpu_type,user,account,cluster)
  - record: slurm_job:process_usage:sum_account
    expr: sum(label_replace(deriv(slurm_job_process_usage_total{}[1m]) &gt; 0, &quot;bin&quot;, &quot;$1&quot;, &quot;exe&quot;, &quot;.*/(.*)&quot;)) by (cluster, account, bin)
</code></pre></div>
<h2 id="access-to-the-database-of-slurmacct">Access to the database of slurmacct</h2>
<p>This MySQL database is accessed by a read-only user. It does not need to be in the same database server where Django is storing its data.</p>
<h2 id="slurm-exporter">slurm-exporter</h2>
<p><a href="https://github.com/guilbaults/prometheus-slurm-exporter/tree/osc">slurm-exporter</a> is used to capture stats from Slurm like the priority of each user. This portal is using a fork, branch <code>osc</code> in the linked repository. This fork support GPU reporting and sshare stats.</p>
<h2 id="lustre_exporter-and-lustre_exporter_slurm">lustre_exporter and lustre_exporter_slurm</h2>
<p>Those 2 exporters are used to gather information about Lustre usage.</p>
<ul>
<li><a href="https://github.com/GSI-HPC/lustre_exporter/">lustre_exporter</a> capture information on Lustre MDS and OSS but will only use \$SLURM_JOBID as a tag on the metrics.</li>
<li><a href="https://github.com/guilbaults/lustre_exporter_slurm">lustre_exporter_slurm</a> is used as a proxy between Prometheus and lustre_exporter to improve the content of the tags. This will match the \$SLURM_JOBID to a job in Slurm and will add the username and Slurm account in the tags.</li>
</ul>
<p>The following recorder rules are used to pre-aggregate stats shown in the user portal.</p>
<div class="highlight"><pre><span></span><code>---
groups:
- name: recorder.rules
  rules:
  - record: lustre:read_bytes:rate3m
    expr: sum(label_replace(rate(lustre_read_bytes_total{component=&quot;ost&quot;}[3m]), &quot;fs&quot;, &quot;$1&quot;, &quot;target&quot;, &quot;(.*)-OST.*&quot;)) by (fs, cluster)
  - record: lustre:write_bytes:rate3m
    expr: sum(label_replace(rate(lustre_write_bytes_total{component=&quot;ost&quot;}[3m]), &quot;fs&quot;, &quot;$1&quot;, &quot;target&quot;, &quot;(.*)-OST.*&quot;)) by (fs, cluster)
  - record: lustre:read_bytes:rate3m_user
    expr: sum by (user,fs,cluster,account) (rate(lustre_job_read_bytes_total{}[3m]))
  - record: lustre:write_bytes:rate3m_user
    expr: sum by (user,fs,cluster,account) (rate(lustre_job_write_bytes_total{}[3m]))
  - record: lustre:metadata:rate3m
    expr: sum(label_replace(rate(lustre_stats_total{component=&quot;mdt&quot;}[3m]), &quot;fs&quot;, &quot;$1&quot;, &quot;target&quot;, &quot;(.*)-MDT.*&quot;)) by (fs,operation,cluster)
  - record: lustre:metadata:rate3m_user
    expr: sum by (user,fs,cluster,account) (rate(lustre_job_stats_total{}[3m]))
</code></pre></div>
<h2 id="gpfs_exporter">gpfs_exporter</h2>
<p><a href="https://github.com/treydock/gpfs_exporter">gpfs_exporter</a> is used to gather quotas from a GPFS filesystem. Learn more in <a href="../quotasgpfs/">quotasgpfs.md</a></p>
<h2 id="redfish_exporter">redfish_exporter</h2>
<p><a href="https://github.com/jenningsloy318/redfish_exporter">redfish_exporter</a> is used to gather the power usage of the nodes. This information is used to compute the energy used by a job and related metrics like CO2 emissions.</p>
<h2 id="node_exporter">node_exporter</h2>
<p><a href="https://github.com/prometheus/node_exporter">node_exporter</a> is used to gather generic information about the nodes. This is the default exporter used by most Prometheus installations. That information is used to show metrics like the local disk IO of the nodes within the job.</p>
<h2 id="libvirtd_exporter">libvirtd_exporter</h2>
<p><a href="https://github.com/guilbaults/libvirtd_exporter/tree/metadata">libvirtd_exporter</a> is used to gather information about the VM running on Openstack.</p>
<h2 id="pcm-sensor-server">pcm-sensor-server</h2>
<p><a href="https://github.com/intel/pcm/">pcm-sensor-server</a> is used to collect low-level data on Intel CPU like L2/L3 cache hit ratio, memory bandwidth, etc.</p>
<h2 id="database-used-by-robinhood">Database used by Robinhood</h2>
<p>The information in this database is used to show the current utilization per user within a group.</p>
<h2 id="slurm-jobscript">Slurm jobscript</h2>
<p>The script <code>slurm_jobscript/slurm_jobscripts.py</code> can be used to add the submitted script to the database of the portal. This should run on the Slurm server, it will collect the scripts from the <code>spool</code> directory of Slurm. This script uses the REST API of Django to push the job script. A user with a token need to be created, check the <a href="../install/">installation documentation</a> on how to create this API token.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>